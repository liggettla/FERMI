#!/usr/bin/env python
# The purpose of this script is to ask how many variants are found within
# a given probed region to see if there is any bias among the probes.

def runArgParse():
    import argparse
    parser = argparse.ArgumentParser()
    parser.add_argument('--inFile', '-i', type=str, required=True, help='The input vcf to be analyzed.')

    args = parser.parse_args()
    inFile = args.inFile

    return inFile

def identifyProbe(location):
    #probes = {'1':['1152278','1152279'],'2':['1152564','1152565','1152566'],'3':['1152587','1152588'],'4':['254572','254573'],'5':['2091130','2091131','2091132'],'6':['1982668','1982669'],'7':['2231906','2231907','2231908'],'8':['2290411','2290412'],'9':['1061972','1061973','1061974'],'10':['1061551','1061552'],'11':['1105411','1105412','1105413'],'12':['1129972','1129973'],'14':['1211677','1211678'],'15':['1235477','1235478','1235479'],'16':['1244286','1244287'],'17':['50737','50738'],'18':['21262','21263','21264'],'19':['23899'],'20':['2390'],'21':['2593','2594'],'22':['114865','114866','114867'],'23':['5342','5343'],'24':['253982','253983','253984'],'25':['253802','253803'],'26':['925270','925271'],'27':['906318','906319'],'28':['733796','733797','733798'],'29':['824550','824551'],'30':['859491','859492'],'31':['75775','75776'],'32':['75783','75784','75785'],'33':['75770','75771','75772'],'34':['486496','486497','486498']}

    probes = {'TIIIa':['1152278','1152279'],'NRAS-1':['1152564','1152565','1152566'],'NRAS-2':['1152587','1152588'],'DNMT3a':['254572','254573'],'IDH1':['2091130','2091131','2091132'],'SF3B1':['1982668','1982669'],'TIIIb':['2231906','2231907','2231908'],'TIIIc':['2290411','2290412'],'TET2-1':['1061972','1061973','1061974'],'TET2-2':['1061551','1061552'],'TIIId':['1105411','1105412','1105413'],'TIIIe':['1129972','1129973'],'TIIIf':['1211677','1211678'],'TIIIg':['1235477','1235478','1235479'],'TIIIh':['1244286','1244287'],'JAK2':['50737','50738'],'TIIIj':['21262','21263','21264'],'TIIIk':['2390'],'TIIIl':['2593','2594'],'TIIIm':['114865','114866','114867'],'HRAS':['5342','5343'],'KRAS-1':['253982','253983','253984'],'KRAS-2':['253802','253803'],'TIIIn':['925270','925271'],'IDH2':['906318','906319'],'TIIIo':['733796','733797','733798'],'TIIIp':['824550','824551'],'TIIIq':['859491','859492'],'p53-1':['75775','75776'],'p53-2':['75783','75784','75785'],'p53-3':['75770','75771','75772'],'GATA1':['486496','486497','486498']}

    for i in probes:
        for j in probes[i]:
            if j in location:
                return i

def displayTally(tally):
    print('Probe\tNum Vars')
    for i in tally:
        print('%s\t%s' % (i, tally[i]))

def plotTally(tally):
    import matplotlib.pyplot as plt

    plt.bar(range(len(tally)), tally.values(), align='center')
    plt.title('Variants Per Probe')
    plt.xlabel('Probes')
    plt.ylabel('Number of Variants')
    plt.xticks(range(len(tally)), tally.keys(), rotation='45')

    plt.show()
    #fig = plt.figure()
    #plt.savefig('output')
    #plt.close(fig)

if __name__ == '__main__':
    from parseLine import seqRead
    inFile = runArgParse()
    target = open(inFile, 'r')

    tally = {'TIIIa':0,'NRAS-1':0,'NRAS-2':0,'DNMT3a':0,'IDH1':0,'SF3B1':0,'TIIIb':0,'TIIIc':0,'TET2-1':0,'TET2-2':0,'TIIId':0,'TIIIe':0,'TIIIf':0,'TIIIg':0,'TIIIh':0,'JAK2':0,'TIIIj':0,'TIIIk':0,'TIIIl':0,'TIIIm':0,'HRAS':0,'KRAS-1':0,'KRAS-2':0,'TIIIn':0,'IDH2':0,'TIIIo':0,'TIIIp':0,'TIIIq':0,'p53-1':0,'p53-2':0,'p53-3':0,'GATA1':0}

    for line in target:
        if '#' not in line and 'chr' in line:
            lineObj = seqRead(line)
            probeNum = identifyProbe(lineObj.loc())
            tally[probeNum] += 1
    
    displayTally(tally)
    plotTally(tally)
